<main class="product-detail">
  @if (product) {
    <div class="container">
      <div class="breadcrumb">
        <a routerLink="/">Home</a>
        <span>/</span>
        <a routerLink="/products">Shop</a>
        <span>/</span>
        <span>{{ product.name }}</span>
      </div>

      <div class="product-content">
        <div class="product-gallery">
          <img [src]="product.image" [alt]="product.name" class="main-image">
        </div>

        <div class="product-info">
          <span class="category-badge">{{ product.category }}</span>
          <h1>{{ product.name }}</h1>

          <div class="rating-row">
            <span class="stars">
              @for (star of [1, 2, 3, 4, 5]; track star) {
                <span [class.filled]="star <= product.rating">‚≠ê</span>
              }
            </span>
            <span class="rating-text">{{ product.rating }} out of 5</span>
          </div>

          <p class="price">‚Çπ{{ product.price.toFixed(2) }}</p>

          <p class="description">{{ product.description }}</p>

          <div class="features">
            <div class="feature">
              <span class="icon">üåø</span>
              <span>Fresh Guarantee</span>
            </div>
            <div class="feature">
              <span class="icon">üöö</span>
              <span>Free Shipping $50+</span>
            </div>
            <div class="feature">
              <span class="icon">üéÅ</span>
              <span>Gift Wrapping</span>
            </div>
          </div>

          <div class="add-to-cart-section">
            <div class="quantity-selector">
              <button (click)="decreaseQuantity()" [disabled]="quantity <= 1">‚àí</button>
              <span>{{ quantity }}</span>
              <button (click)="increaseQuantity()">+</button>
            </div>

            <button class="btn-add-to-cart" (click)="addToCart()">
              Add to Cart - ‚Çπ{{ (product.price * quantity).toFixed(2) }}
            </button>

            <button
              class="btn-wishlist"
              [class.active]="wishlistService.has(product.id)"
              (click)="wishlistService.toggle(product)"
              [title]="wishlistService.has(product.id) ? 'Remove from wishlist' : 'Save to wishlist'">
              @if (wishlistService.has(product.id)) {
                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
                Saved
              } @else {
                <svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                </svg>
                Save
              }
            </button>
          </div>

          <div class="stock-status" [class.in-stock]="product.inStock">
            @if (product.inStock) {
              <span>‚úì In Stock - Ready to Ship</span>
            } @else {
              <span>‚úó Out of Stock</span>
            }
          </div>
        </div>
      </div>

      @if (relatedProducts.length > 0) {
        <section class="related-products">
          <h2>You May Also Like</h2>
          <div class="product-grid">
            @for (item of relatedProducts; track item.id) {
              <a [routerLink]="['/products', item.id]" class="product-card">
                <div class="product-image">
                  <img [src]="item.image" [alt]="item.name">
                </div>
                <div class="product-info">
                  <h3>{{ item.name }}</h3>
                  <span class="price">‚Çπ{{ item.price.toFixed(2) }}</span>
                </div>
              </a>
            }
          </div>
        </section>
      }
    </div>
  }
</main>
