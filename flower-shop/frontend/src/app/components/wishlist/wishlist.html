<main class="wishlist-page">

  <!-- ── Header ──────────────────────────────────────────────────────────── -->
  <div class="wishlist-header">
    @if (isSharedView) {
      <div class="header-left">
        <h1>Shared Wishlist</h1>
        <span class="item-count">{{ displayProducts.length }} item{{ displayProducts.length !== 1 ? 's' : '' }}</span>
      </div>
      <div class="shared-banner">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
        </svg>
        <span>Someone shared this wishlist with you</span>
        @if (displayProducts.length > 0) {
          <button class="btn-save-all" (click)="saveSharedToWishlist()">
            Save All to My Wishlist
          </button>
        }
      </div>
    } @else {
      <div class="header-left">
        <h1>My Wishlist</h1>
        <span class="item-count">{{ displayProducts.length }} item{{ displayProducts.length !== 1 ? 's' : '' }}</span>
      </div>
      @if (displayProducts.length > 0) {
        <div class="header-actions">
          <button class="btn-add-all" (click)="moveAllToCart()">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="9" cy="21" r="1"></circle>
              <circle cx="20" cy="21" r="1"></circle>
              <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg>
            Add All to Cart
          </button>
          <button class="btn-share" (click)="shareWishlist()">
            <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="18" cy="5" r="3"></circle>
              <circle cx="6" cy="12" r="3"></circle>
              <circle cx="18" cy="19" r="3"></circle>
              <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
              <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
            </svg>
            Share Wishlist
          </button>
        </div>
      }
    }
  </div>

  <!-- ── Product Grid ─────────────────────────────────────────────────────── -->
  @if (displayProducts.length > 0) {
    <div class="wishlist-grid">
      @for (product of displayProducts; track product.id) {
        <div class="wishlist-card">
          <a [routerLink]="['/products', product.id]" class="card-image-link">
            <img [src]="product.image" [alt]="product.name" loading="lazy">
          </a>
          <div class="card-info">
            <h3><a [routerLink]="['/products', product.id]">{{ product.name }}</a></h3>
            <p class="card-price">₹{{ product.price.toFixed(2) }}</p>
          </div>
          <div class="card-actions">
            <button class="btn-cart" (click)="addToCart(product)">
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
              Add to Cart
            </button>
            @if (isSharedView) {
              <button
                class="btn-save"
                (click)="saveOneToWishlist(product)"
                [class.saved]="wishlistService.has(product.id)">
                @if (wishlistService.has(product.id)) {
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                  </svg>
                  Saved
                } @else {
                  <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
                  </svg>
                  Save
                }
              </button>
            } @else {
              <button class="btn-remove" (click)="wishlistService.remove(product.id)">
                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"></path>
                  <path d="M10 11v6"></path><path d="M14 11v6"></path>
                </svg>
                Remove
              </button>
            }
          </div>
        </div>
      }
    </div>
  } @else {
    <!-- ── Empty State ─────────────────────────────────────────────────────── -->
    <div class="empty-wishlist">
      <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
      </svg>
      @if (isSharedView) {
        <h2>This wishlist is empty</h2>
        <p>The shared wishlist has no items.</p>
      } @else {
        <h2>Your wishlist is empty</h2>
        <p>Save flowers you love and come back to them anytime.</p>
      }
      <a routerLink="/" class="btn-browse">Browse Collection</a>
    </div>
  }

</main>

<!-- ── Cart Toast ───────────────────────────────────────────────────────────── -->
<div class="cart-toast" [class.show]="toastVisible()">
  <div class="toast-icon">
    <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="20 6 9 17 4 12"></polyline>
    </svg>
  </div>
  <div class="toast-text">
    <span class="toast-title">Added to Cart!</span>
    <span class="toast-name">{{ toastProductName() }}</span>
  </div>
</div>

<!-- ── Share Toast ──────────────────────────────────────────────────────────── -->
<div class="share-toast" [class.show]="shareVisible()">
  <svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="20 6 9 17 4 12"></polyline>
  </svg>
  Link copied to clipboard!
</div>
